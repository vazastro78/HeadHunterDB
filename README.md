# Курсовая 5.  Работа с базами данных

В рамках проекта вам необходимо получить данные о компаниях и вакансиях с сайта hh.ru, спроектировать таблицы в БД PostgreSQL и загрузить полученные данные в созданные таблицы.


### Задача
Необходимо получить данные о компаниях и вакансиях с сайта hh.ru, спроектировать таблицы в БД PostgreSQL и загрузить полученные данные в созданные таблицы.

#### Основные шаги проекта
- Получить данные о работодателях и их вакансиях с сайта hh.ru. Для этого используйте публичный API hh.ru и библиотеку requests.
- Выбрать не менее 10 интересных вам компаний, от которых вы будете получать данные о вакансиях по API.
- Спроектировать таблицы в БД PostgreSQL для хранения полученных данных о работодателях и их вакансиях. Для работы с БД используйте библиотеку psycopg2.
- Реализовать код, который заполняет созданные в БД PostgreSQL таблицы данными о работодателях и их вакансиях.
- Создать класс  DBManager для работы с данными в БД.

### Настройка базы данных и таблиц

Для настройки базы данных и таблиц необходимо выполнить запросы из файлов в директории sql/

- 0001_schema.sql  создается пользователь и база данных
- 0002_keywords.sql создается таблица  keywords для работы с ключевыми словами (уже не актуально)
- 0003_employer.sql создается таблица работодателей employer 
- 0004_vacancy.sql создается таблица вакансий vacancy
- 0005_vacancy_keyword.sql создается таблица связей вакансий и ключевых слов vacancy_keyword  (уже не актуально)

### Реализация класса DBManager

Создайте класс DBManager, который будет подключаться к БД PostgreSQL и иметь следующие методы:
- get_companies_and_vacancies_count() — получает список всех компаний и количество вакансий у каждой компании.  
- get_all_vacancies() — получает список всех вакансий с указанием названия компании, названия вакансии и зарплаты и ссылки на вакансию.
- get_avg_salary() — получает среднюю зарплату по вакансиям.
- get_vacancies_with_higher_salary() — получает список всех вакансий, у которых зарплата выше средней по всем вакансиям.
- get_vacancies_with_keyword() — получает список всех вакансий, в названии которых содержатся переданные в метод слова, например python.


#### Функции класса DBManager
- get_companies_and_vacancies_count() — получает список всех компаний и количество вакансий у каждой компании.  

``` sql
SELECT E.name, COUNT(V.name) FROM vacancy AS V
JOIN  employer AS E USING(employer_id) GROUP BY E.name
	ORDER BY COUNT(V.name) DESC;
```

- get_all_vacancies() — получает список всех вакансий с указанием названия компании, названия вакансии и зарплаты и ссылки на вакансию.
``` sql
SELECT E.name, V.name, V.url FROM vacancy AS V
	JOIN employer AS E USING(employer_id);
```
	
- get_avg_salary() — получает среднюю зарплату по вакансиям.
``` sql
SELECT AVG(V.salary)  FROM vacancy AS V
	WHERE LOWER(V.name) like LOWER('%администратор%') and V.salary>0 ;
```


- get_vacancies_with_higher_salary() — получает список всех вакансий, у которых зарплата выше средней по всем вакансиям.
``` sql
SELECT DISTINCT name  FROM vacancy AS V
	WHERE salary > (SELECT AVG(V.salary) FROM vacancy AS V WHERE salary>0);
```
	
- get_vacancies_with_keyword() — получает список всех вакансий, в названии которых содержатся переданные в метод слова, например python.
``` sql
SELECT DISTINCT V.name FROM vacancy AS V
	WHERE LOWER(V.name) like LOWER('%офис%');

SELECT DISTINCT V.name FROM vacancy AS V
	WHERE LOWER(V.name) like LOWER('%администратор%');
```




Класс DBManager должен использовать библиотеку psycopg2 для работы с БД.


### Реализация классов python

- Класс Vacancy определяет работу с вакансиями
  - для сортировки используется переопределенная магическая функция \_\_hash\_\_, которая сравнивает максимальную зарплату
  - для фильтра по ключевым словам используется переопределенная магическая функция \_\_contains\_\_, путем поиска подстроки внутри строки
  - для отбора попадающих в нужный диапазон зарплат отвечает функция is_salary_between(min_value, max_value)
  - для удобства сравнения (знаки больше и меньше) переопределены. Можно даже с вакансию с числом сравнивать. 

- Использован абстрактный класс JobApplicationParser, который может выступать основой для разных поисковых запросов к сервисам поиска работы
- Класс HeadHunterParser наследует абстрактный класс JobApplicationParser
- в файле main.py основные функции для получения законченной работающей программы 

Замечания:
- is_online = False в файле main.py позволяет не перечитывать из интернета, а использовать записанный локально файл


## Критерии выполнения проверены


- [x]  Проект выложили на GitHub.
- [x]  Из файла README понятно, о чём проект и как его использовать.
- [x]  В Git есть точечные коммиты.
- [x]  Код программы грамотно разбит на функции/классы/модули/пакеты.
- [x]  Код читабельный (хороший нейминг, есть docstring, используется typing).
- [x]  В работе используются абстрактные классы (минимум один).
- [x]  В работе есть переопределение магических методов.
- [x]  Для работы с API используется библиотека requests.
- [x]  В ходе работы программы создается файл со списком вакансий.
- [x]  Пользователь может вывести из файла набор вакансий по определенным критериям.

### Требования

- Создать абстрактный класс для работы с API сервиса с вакансиями. Реализовать класс, наследующийся от абстрактного класса, для работы с платформой hh.ru. Класс должен уметь подключаться к API и получать вакансии.
- Создать класс для работы с вакансиями. В этом классе самостоятельно определить атрибуты, такие как название вакансии, ссылка на вакансию, зарплата, краткое описание или требования и т. п. (всего не менее четырех атрибутов). Класс должен поддерживать методы сравнения вакансий между собой по зарплате и валидировать данные, которыми инициализируются его атрибуты. 
- > Способами валидации данных может быть проверка, указана или нет зарплата. В этом случае выставлять значение зарплаты 0 или «Зарплата не указана» в зависимости от структуры класса.
- Определить абстрактный класс, который обязывает реализовать методы для добавления вакансий в файл, получения данных из файла по указанным критериям и удаления информации о вакансиях. Создать класс для сохранения информации о вакансиях в JSON-файл. Дополнительно, по желанию, можно реализовать классы для работы с другими форматами, например с CSV- или Excel-файлом, с TXT-файлом.
- > Данный класс выступит в роли основы для коннектора, заменяя который (класс-коннектор), можно использовать в качестве хранилища одну из баз данных или удаленное хранилище со своей специфической системой обращений.
- > В случае если какие-то из методов выглядят не используемыми для работы с файлами, то не стоит их удалять. Они пригодятся для интеграции к БД. Сделайте заглушку в коде.
- Создать функцию для взаимодействия с пользователем. Функция должна взаимодействовать с пользователем через консоль. Возможности этой функции должны быть следующими: 
  - ввести поисковый запрос для запроса вакансий из hh.ru;
  - получить топ N вакансий по зарплате (N запрашивать у пользователя);
  - получить вакансии с ключевым словом в описании.

Помимо этого функционала, можно придумать дополнительные возможности, которые покажутся удобными.
- Объединить все классы и функции в единую программу.
- Покрыть описанный функционал тестами.


### Требования к реализации в парадигме ООП
-Абстрактный класс и классы для работы с API платформ с вакансиями должны быть реализованы в соответствии с принципом наследования.
-Класс для работы с вакансиями должен быть реализован в соответствии с принципом инкапсуляции и поддерживать методы сравнения вакансий между собой по зарплате.
-Классы и другие сущности в проекте должны удовлетворять минимум первым двум требованиям принципов SOLID.

